<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eetplanner Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#D946EF">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* =========================================
           NEXT-LEVEL MODERN THEMES & VARIABLES 
           ========================================= */
        :root { 
            /* Paars -> Roze -> Blauw Gradient */
            --gradient-main: linear-gradient(135deg, #6366F1 0%, #D946EF 50%, #3B82F6 100%);
            --gradient-hover: linear-gradient(135deg, #4F46E5 0%, #C026D3 50%, #2563EB 100%);
            --primary: #D946EF; 
            --secondary: #3B82F6; 
            --bg-color: #F8FAFC; /* Zeer licht blauw/grijs voor moderne look */
            --card-bg: rgba(255, 255, 255, 0.85); /* Glassmorphism basis */
            --text-main: #1E293B; 
            --text-muted: #64748B; 
            --border-color: rgba(255,255,255,0.6);
            --shadow-soft: 0 10px 40px rgba(99, 102, 241, 0.08);
            --shadow-hover: 0 20px 40px rgba(99, 102, 241, 0.15);
        }
        
        /* üéÄ BARBIE THEMA OVERRIDE üéÄ */
        body.barbie-mode { 
            --gradient-main: linear-gradient(135deg, #FF1493 0%, #FF69B4 50%, #00BCD4 100%);
            --gradient-hover: linear-gradient(135deg, #D81B60 0%, #E91E63 50%, #00ACC1 100%);
            --primary: #FF1493; 
            --secondary: #00BCD4; 
            --bg-color: #FDF2F8; 
            --shadow-soft: 0 10px 40px rgba(255, 20, 147, 0.08);
            --shadow-hover: 0 20px 40px rgba(255, 20, 147, 0.15);
        }
        
        /* =========================================
           GLOBAL STYLES
           ========================================= */
        * { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: var(--bg-color); 
            background-image: radial-gradient(circle at top right, rgba(217, 70, 239, 0.05), transparent 40%),
                              radial-gradient(circle at bottom left, rgba(59, 130, 246, 0.05), transparent 40%);
            background-attachment: fixed;
            color: var(--text-main); 
            margin: 0; 
            padding: 15px; 
            padding-top: max(15px, env(safe-area-inset-top)); 
            min-height: 100vh;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding-bottom: 60px; }
        
        /* =========================================
           CONTROLS & NAVIGATION (GLASSMORPHISM)
           ========================================= */
        .controls-bar { 
            display: flex; flex-direction: column; gap: 20px; align-items: center; 
            background: var(--card-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 25px; border-radius: 24px; margin-bottom: 25px; 
            box-shadow: var(--shadow-soft); border: 1px solid var(--border-color);
        }
        
        .family-selector { display: flex; gap: 15px; width: 100%; justify-content: center; flex-wrap: wrap; }
        
        .family-btn {
            padding: 14px 24px; border: 2px solid transparent; border-radius: 16px;
            font-size: 1rem; font-weight: 700; cursor: pointer; flex: 1; min-width: 160px; max-width: 250px;
            background: #F1F5F9; color: var(--text-muted); text-align: center;
            position: relative; z-index: 1; overflow: hidden;
        }
        
        .family-btn.active { 
            background: transparent; color: white; transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1); border-color: transparent;
        }
        .family-btn.active::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--gradient-main); z-index: -1;
        }
        
        /* Nav Tabs */
        .nav-tabs { display: flex; gap: 12px; margin-bottom: 25px; justify-content: center; }
        .tab-btn { 
            padding: 12px 30px; border-radius: 30px; border: none; cursor: pointer; 
            background: rgba(0,0,0,0.04); color: var(--text-muted); font-weight: 700; font-size: 0.95rem;
        }
        .tab-btn:hover { background: rgba(0,0,0,0.08); }
        .tab-btn.active { 
            background: var(--gradient-main); color: white; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); transform: translateY(-2px);
        }

        /* Selects & Utilities */
        select { 
            padding: 12px 24px; border-radius: 16px; border: 2px solid rgba(0,0,0,0.1); 
            background: white; color: var(--text-main); font-weight: 700; font-size: 1rem; 
            outline: none; cursor: pointer; box-shadow: var(--shadow-soft);
        }
        select:focus { border-color: var(--primary); }
        
        .reset-btn {
            border: none; background: #FEE2E2; color: #EF4444; padding: 12px 24px; 
            border-radius: 16px; cursor: pointer; font-weight: 700; font-size: 0.95rem;
        }
        .reset-btn:hover { background: #FECACA; transform: scale(1.05); }

        /* =========================================
           PRICE BANNER
           ========================================= */
        .total-box { 
            background: var(--gradient-main); color: white; padding: 18px; 
            border-radius: 20px; text-align: center; margin-bottom: 30px; 
            font-weight: 800; font-size: 1.4rem; letter-spacing: 0.5px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        /* =========================================
           SHOPPING GRID
           ========================================= */
        .shopping-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 40px; }
        
        .shop-card { 
            background: var(--card-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 24px; border-radius: 24px; box-shadow: var(--shadow-soft); border: 1px solid var(--border-color);
        }
        .shop-card h3 { 
            margin-top: 0; font-size: 1.2rem; border-bottom: 2px dashed rgba(0,0,0,0.1); 
            padding-bottom: 12px; margin-bottom: 15px; 
            background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
        }
        
        .item-list { list-style: none; padding: 0; margin: 0; }
        .item-list li { 
            display: flex; justify-content: space-between; align-items: center; padding: 14px 10px; 
            border-bottom: 1px solid rgba(0,0,0,0.04); font-size: 0.95rem; cursor: pointer; border-radius: 12px;
        }
        .item-list li:hover { background: rgba(0,0,0,0.02); padding-left: 15px; }
        
        /* Next-Level Checkboxes */
        .stock-check { 
            width: 24px; height: 24px; border: 2px solid #CBD5E1; border-radius: 8px; 
            margin-right: 14px; display: inline-flex; justify-content: center; align-items: center;
            background: transparent; flex-shrink: 0; transition: 0.2s;
        }
        .item-list li.stocked { color: var(--text-muted); opacity: 0.6; text-decoration: line-through; }
        .item-list li.stocked .stock-check { 
            background: var(--gradient-main); border-color: transparent; transform: scale(1.1);
        }
        .item-list li.stocked .stock-check::after { 
            content: '‚úì'; color: #fff; font-size: 14px; font-weight: 800;
        }

        /* =========================================
           CALENDAR CARDS (RECIPES)
           ========================================= */
        .calendar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }
        
        .day-card { 
            background: var(--card-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 25px; border-radius: 24px; cursor: pointer; 
            position: relative; overflow: hidden; border: 1px solid var(--border-color);
            box-shadow: var(--shadow-soft); display: flex; flex-direction: column;
        }
        .day-card:hover { transform: translateY(-6px); box-shadow: var(--shadow-hover); }

        .day-card h3 { color: var(--text-main); margin: 5px 0 15px 0; font-size: 1.15rem; font-weight: 800; padding-right: 50px; line-height: 1.4; }
        
        .stat-bar { display: flex; flex-wrap: wrap; gap: 10px; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 18px; font-weight: 600; }
        .stat-bar span { background: rgba(0,0,0,0.04); padding: 6px 12px; border-radius: 20px; }
        
        .mini-ing-box { background: rgba(0,0,0,0.02); border: 1px solid rgba(0,0,0,0.03); padding: 14px; border-radius: 16px; font-size: 0.85rem; color: var(--text-muted); flex-grow: 1; line-height: 1.6; }

        /* The Check Button in Day Card */
        .check-btn { 
            position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; 
            border-radius: 12px; background: rgba(0,0,0,0.05); border: none; cursor: pointer; color: transparent;
            z-index: 20; font-size: 1.2rem; display:flex; align-items:center; justify-content:center;
        }
        .check-btn:hover { background: rgba(0,0,0,0.1); transform: scale(1.05); }
        .day-card.completed .check-btn { background: var(--gradient-main); color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        /* COMPLETED STATE & ANIMATION */
        @keyframes scrollText {
            0% { transform: translate(0, -50%); }
            100% { transform: translate(-50%, -50%); }
        }

        .day-card.completed { border: 1px solid rgba(0,0,0,0.05); opacity: 0.9; }
        .day-card.completed > *:not(.check-btn) { opacity: 0.3; filter: grayscale(100%); }

        .day-card.completed::before {
            content: "AL GEMAAKT ‚ú® AL GEMAAKT ‚ú® AL GEMAAKT ‚ú® AL GEMAAKT";
            position: absolute; top: 50%; left: 0; width: 300%; transform: translateY(-50%);
            background: var(--gradient-main); color: #fff; font-weight: 800; font-size: 1.6rem;
            padding: 18px 0; white-space: nowrap; animation: scrollText 8s linear infinite;
            z-index: 10; display: flex; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
        }

        /* =========================================
           MODAL (POPUP RECIPE)
           ========================================= */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
        
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-content { 
            background: white; margin: 5% auto; padding: 35px; width: 92%; max-width: 650px; 
            border-radius: 30px; position: relative; max-height: 85vh; overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .close { position: absolute; right: 25px; top: 25px; width: 36px; height: 36px; background: rgba(0,0,0,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; color: var(--text-main); }
        .close:hover { background: rgba(0,0,0,0.1); transform: rotate(90deg); }

        .modal-content h2 { margin-top: 0; font-size: 1.6rem; line-height: 1.3; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; padding-right: 40px; }
        
        #mStats { display:flex; flex-wrap: wrap; gap:12px; margin-bottom:25px; }
        #mStats span { background: var(--bg-color); padding: 8px 16px; border-radius: 12px; font-size: 0.9rem; font-weight: 700; color: var(--text-main); }
        
        .modal-content h4 { font-size: 1.1rem; margin-top: 25px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        #mIng { padding-left: 20px; line-height: 1.8; color: var(--text-muted); font-size: 1rem; }
        #mSteps p { background: var(--bg-color); padding: 15px 20px; border-radius: 16px; margin-bottom: 12px; color: var(--text-main); line-height: 1.6; font-size: 0.95rem; }
        
        #mKid { background: linear-gradient(135deg, #FEF08A 0%, #FDE047 100%); padding: 18px; border-radius: 16px; margin-top: 30px; color: #854D0E; font-weight: 600; line-height: 1.5; box-shadow: 0 4px 15px rgba(253, 224, 71, 0.3); }

        /* Custom Scrollbar for Modal */
        .modal-content::-webkit-scrollbar { width: 8px; }
        .modal-content::-webkit-scrollbar-track { background: transparent; }
        .modal-content::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="controls-bar">
        <div class="family-selector">
            <button class="family-btn active" data-family="ricour" onclick="setFamily('ricour')">
                üåø Ricour (3p)
            </button>
            <button class="family-btn" data-family="hemmeryckx" onclick="setFamily('hemmeryckx')">
                üéÄ Hemmeryckx (2p)
            </button>
        </div>

        <div style="display:flex; gap:15px; align-items:center; flex-wrap:wrap; justify-content:center;">
            <select id="monthSelect" onchange="loadNewData()">
                <option value="januari">Januari</option>
                <option value="februari">Februari</option>
                <option value="maart">Maart</option>
            </select>
            <button class="reset-btn" onclick="clearProgress()">‚Üª Reset Alles</button>
        </div>
    </div>

    <div class="nav-tabs">
        <button id="w12Btn" class="tab-btn active" onclick="setPeriode('w1&2')">Week 1 & 2</button>
        <button id="w34Btn" class="tab-btn" onclick="setPeriode('w3&4')">Week 3 & 4</button>
    </div>

    <div id="priceBanner" class="total-box">Laden...</div>

    <div class="shopping-grid">
        <div class="shop-card"><h3>ü•© Vlees & Vis</h3><ul id="vList" class="item-list"></ul></div>
        <div class="shop-card"><h3>ü•¶ Groenten</h3><ul id="gList" class="item-list"></ul></div>
        <div class="shop-card"><h3>ü•´ Voorraad</h3><ul id="kList" class="item-list"></ul></div>
    </div>

    <div id="calendar" class="calendar-grid"></div>
</div>

<div id="receptModal" class="modal">
    <div class="modal-content">
        <div class="close" onclick="closeModal()">&times;</div>
        <h2 id="mTitle"></h2>
        <div id="mStats"></div>
        <h4>üõí Boodschappenlijst</h4>
        <ul id="mIng"></ul>
        <h4>üë©‚Äçüç≥ Bereidingswijze</h4>
        <div id="mSteps"></div>
        <div id="mKid"></div>
    </div>
</div>

<script>
    let currentPeriode = 'w1&2';
    let currentFamilyKey = 'ricour'; 
    let completedRecipes = JSON.parse(localStorage.getItem('completedRecipes')) || [];
    let stockedItems = JSON.parse(localStorage.getItem('stockedItems')) || [];
    let barbieAudio = new Audio('barbie.mp3'); 
    barbieAudio.loop = true;

    function setFamily(key) {
        currentFamilyKey = key;
        document.querySelectorAll('.family-btn').forEach(btn => {
            btn.classList.remove('active');
            if(btn.getAttribute('data-family') === key) btn.classList.add('active');
        });

        if (key === 'hemmeryckx') {
            barbieAudio.play().catch(e => console.log("Audio autoplay blokkade", e));
        } else {
            barbieAudio.pause();
            barbieAudio.currentTime = 0;
        }
        updateUI();
    }

    function initSmartDate() {
        const today = new Date();
        const month = today.getMonth(); // 0=Jan, 1=Feb, 2=Mrt
        const day = today.getDate();

        const monthSelect = document.getElementById('monthSelect');
        if (month === 0) monthSelect.value = "januari";
        else if (month === 1) monthSelect.value = "februari";
        else if (month === 2) monthSelect.value = "maart";
        
        if (day > 15) {
            currentPeriode = 'w3&4';
        } else {
            currentPeriode = 'w1&2';
        }

        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        if(currentPeriode === 'w1&2') document.getElementById('w12Btn').classList.add('active');
        else document.getElementById('w34Btn').classList.add('active');

        loadNewData();
    }

    function loadNewData() {
        const maand = document.getElementById('monthSelect').value;
        const banner = document.getElementById('priceBanner');
        banner.innerText = "Bezig met laden...";
        
        const oldScript = document.getElementById('data-script');
        if (oldScript) oldScript.remove();

        const script = document.createElement('script');
        script.id = 'data-script';
        script.src = `${maand}/recepten_${currentPeriode}.js?t=${new Date().getTime()}`;
        
        script.onload = () => {
            if (typeof shoppingData === 'undefined') {
                banner.innerText = "Error: Data niet gevonden";
                banner.style.background = "#EF4444";
            } else {
                updateUI();
            }
        };
        
        script.onerror = () => {
            banner.innerText = `Bestand niet gevonden: ${maand}/recepten_${currentPeriode}.js`;
            banner.style.background = "#EF4444";
        };
        
        document.head.appendChild(script);
    }

    function setPeriode(p) {
        currentPeriode = p;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(p === 'w1&2' ? 'w12Btn' : 'w34Btn').classList.add('active');
        loadNewData();
    }

    function toggleRecipe(id, event) {
        event.stopPropagation();
        if (completedRecipes.includes(id)) {
            completedRecipes = completedRecipes.filter(rid => rid !== id);
        } else {
            completedRecipes.push(id);
        }
        localStorage.setItem('completedRecipes', JSON.stringify(completedRecipes));
        updateUI();
    }

    function toggleStock(itemName) {
        if (stockedItems.includes(itemName)) {
            stockedItems = stockedItems.filter(i => i !== itemName);
        } else {
            stockedItems.push(itemName);
        }
        localStorage.setItem('stockedItems', JSON.stringify(stockedItems));
        updateUI();
    }

    function clearProgress() {
        if(confirm("Weet je zeker dat je alle vinkjes wilt resetten?")) {
            completedRecipes = []; stockedItems = [];
            localStorage.removeItem('completedRecipes'); localStorage.removeItem('stockedItems');
            updateUI();
        }
    }

    function updateUI() {
        try {
            document.body.className = ''; 
            let factor = 1.0;

            if (currentFamilyKey === 'hemmeryckx') {
                document.body.classList.add('barbie-mode');
                factor = 0.67; 
            }

            if (typeof shoppingData === 'undefined' || typeof recipeData === 'undefined') return;

            const currentShopData = shoppingData[currentFamilyKey] || shoppingData['ricour'];

            let totalCost = 0;
            const renderShopList = (id, list) => {
                const el = document.getElementById(id); el.innerHTML = '';
                if(!list) return;

                list.forEach(itemStr => {
                    const parts = itemStr.split(' - ‚Ç¨');
                    const name = parts[0];
                    const price = parts[1] ? parseFloat(parts[1]) : 0;
                    const isStocked = stockedItems.includes(name);
                    
                    if (!isStocked) totalCost += price;

                    const li = document.createElement('li');
                    li.className = isStocked ? 'stocked' : '';
                    li.onclick = () => toggleStock(name);
                    li.innerHTML = `<div style="display:flex; align-items:center;"><span class="stock-check"></span>${name}</div><b>${price > 0 ? '‚Ç¨'+price.toFixed(2) : ''}</b>`;
                    el.appendChild(li);
                });
            };

            renderShopList('vList', currentShopData.v);
            renderShopList('gList', currentShopData.g);
            renderShopList('kList', currentShopData.k);
            
            const banner = document.getElementById('priceBanner');
            banner.style.background = ''; // Reset error color if any
            banner.innerText = `Boodschappen Totaal: ‚Ç¨${totalCost.toFixed(2)}`;

            const grid = document.getElementById('calendar'); grid.innerHTML = '';
            recipeData.recipes.forEach(x => {
                const safeId = x.id || Math.random().toString(36).substr(2, 9);
                const isDone = completedRecipes.includes(safeId);
                
                const card = document.createElement('div');
                card.className = `day-card ${isDone ? 'completed' : ''}`;
                const ingPreview = x.ing ? x.ing.map(i => i.replace(/^[\d.,]+(g|ml|l|kg|stuks|st|pak|blik|el|tl)?\s*/i, '')).slice(0, 3).join(', ') : '';

                card.innerHTML = `
                    <button class="check-btn" onclick="toggleRecipe('${safeId}', event)">‚úì</button>
                    <h3>${x.m}</h3>
                    <div class="stat-bar"><span>üî• ${x.kcal} kcal</span><span>üí™ ${x.p}g eiwit</span><span>üïí ${x.t} min</span></div>
                    <div class="mini-ing-box">üõí ${ingPreview}...</div>
                `;
                card.onclick = () => showModal(x, factor);
                grid.appendChild(card);
            });

        } catch (error) {
            console.error(error);
        }
    }

    function showModal(x, f) {
        document.getElementById('mTitle').innerText = x.m;
        document.getElementById('mStats').innerHTML = `<span>üî• ${x.kcal} kcal/p</span> <span>üí™ ${x.p}g eiwit</span> <span>üïí ${x.t} min</span>`;
        
        if(x.ing) {
            document.getElementById('mIng').innerHTML = x.ing.map(i => {
                let newItem = i.replace(/(\d+([.,]\d+)?)/g, (match) => {
                    let num = parseFloat(match.replace(',', '.'));
                    let raw = num * f;
                    let rounded = (raw > 10) ? Math.round(raw / 5) * 5 : Math.round(raw * 10) / 10;
                    return rounded;
                });
                return `<li>${newItem}</li>`;
            }).join('');
        }
        
        if(x.steps) document.getElementById('mSteps').innerHTML = x.steps.map(s => `<p>${s}</p>`).join('');
        
        const kidEl = document.getElementById('mKid');
        kidEl.style.display = x.kid ? 'block' : 'none';
        kidEl.innerHTML = x.kid ? `<b>üë∂ Kind-Tip:</b> ${x.kid}` : '';
        document.getElementById('receptModal').style.display = 'block';
    }

    function closeModal() { document.getElementById('receptModal').style.display = 'none'; }
    window.onclick = (e) => { if(e.target.className === 'modal') closeModal(); }
    
    // START SCRIPT MET SMART DATE
    window.onload = initSmartDate;
</script>
</body>
</html>
